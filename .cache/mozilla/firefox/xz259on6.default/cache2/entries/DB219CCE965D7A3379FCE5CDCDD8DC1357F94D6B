<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv='Pragma' content='no-cache'/>

        <script type="text/javascript">
            /*
             JQuery is not compatible with PSP & NDSi
             script execution will stop when the jquery import.
             we should put the following script before the jquery is imported
             */
            var hardwarePlatform = navigator.platform.toLowerCase();
            var agent = navigator.userAgent.toLowerCase();
            var isPsp = (agent.indexOf("playstation") != -1);
            var isNdsi = (agent.indexOf("nintendo dsi") != -1);
            if (isPsp || isNdsi) {
                window.location.href = "notsupported.html";
            }
        </script>

        <script type="text/javascript" src="../lib/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="../lib/log4javascript_lite.js"></script>
        <script type="text/javascript" src="../js/redirect.js"></script>

        <title></title>

        <script type="text/javascript">
            var DEFAULT_GATEWAY_IP = "192.168.1.1";
            var DEFAULT_GATEWAY_DOMAIN = new Array();
            var AJAX_HEADER = '../';
            var AJAX_TAIL = '';
            var AJAX_TIMEOUT = 30000;
            
            var MACRO_NO_SIM_CARD = '255';
            var MACRO_CPIN_FAIL = '256';
            var MACRO_PIN_READY = '257';
            var MACRO_PIN_DISABLE = '258';
            var MACRO_PIN_VALIDATE = '259';
            var MACRO_PIN_REQUIRED = '260';
            var MACRO_PUK_REQUIRED = '261';

            var log = log4javascript.getNullLogger();
            function gotoPageWithoutHistory(url) {
                log.debug('MAIN : gotoPageWithoutHistory(' + url + ')');
                window.location.replace(url);
            }

            // internal use only
            function _recursiveXml2Object($xml) {
                if ($xml.children().size() > 0) {
                    var _obj = {};
                    $xml.children().each(function() {
                        var _childObj = ($(this).children().size() > 0) ? _recursiveXml2Object($(this)) : $(this).text();
                        if ($(this).siblings().size() > 0 && $(this).siblings().get(0).tagName == this.tagName) {
                            if (_obj[this.tagName] == null) {
                                _obj[this.tagName] = [];
                            }
                            _obj[this.tagName].push(_childObj);
                        }
                        else {
                            _obj[this.tagName] = _childObj;
                        }
                    });
                    return _obj;
                }
                else {
                    return $xml.text();
                }
            }

            // convert XML string to an Object.
            // $xml, which is an jQuery xml object.
            function xml2object($xml) {
                var obj = new Object();
                if ($xml.find('response').size() > 0) {
                    var _response = _recursiveXml2Object($xml.find('response'));
                    obj.type = 'response';
                    obj.response = _response;
                }
                else if ($xml.find('error').size() > 0) {
                    var _code = $xml.find('code').text();
                    var _message = $xml.find('message').text();
                    log.warn('MAIN : error code = ' + _code);
                    log.warn('MAIN : error msg = ' + _message);
                    obj.type = 'error';
                    obj.error = {
                        code: _code,
                        message: _message
                    };
                }
                else if ($xml.find('config').size() > 0) {
                    var _config = _recursiveXml2Object($xml.find('config'));
                    obj.type = 'config';
                    obj.config = _config;
                }
                else {
                    obj.type = 'unknown';
                }
                return obj;
            }

            function getAjaxData(urlstr, callback_func, options) {
                var myurl = AJAX_HEADER + urlstr + AJAX_TAIL;
                var isAsync = true;
                var nTimeout = AJAX_TIMEOUT;
                var errorCallback = null;
            
                if (options) {
                    if (options.sync) {
                        isAsync = (options.sync == true) ? false : true;
                    }
                    if (options.timeout) {
                        nTimeout = parseInt(options.timeout, 10);
                        if (isNaN(nTimeout)) {
                            nTimeout = AJAX_TIMEOUT;
                        }
            
                    }
                    errorCallback = options.errorCB;
                }
                var headers = {};
                headers['__RequestVerificationToken'] = g_requestVerificationToken;
                
                $.ajax({
                    async: isAsync,
                    headers: headers,
                    //cache: false,
                    type: 'GET',
                    timeout: nTimeout,
                    url: myurl,
                    //dataType: ($.browser.msie) ? "text" : "xml",
                    error: function(XMLHttpRequest, textStatus) {
                        try {
                            if (jQuery.isFunction(errorCallback)) {
                                errorCallback(XMLHttpRequest, textStatus);
                            }
                            log.error('MAIN : getAjaxData(' + myurl + ') error.');
                            log.error('MAIN : XMLHttpRequest.readyState = ' + XMLHttpRequest.readyState);
                            log.error('MAIN : XMLHttpRequest.status = ' + XMLHttpRequest.status);
                            log.error('MAIN : textStatus ' + textStatus);
                        }
                        catch (exception) {
                            log.error(exception);
                        }
                    },
                    success: function(data) {
                        log.debug('MAIN : getAjaxData(' + myurl + ') sucess.');
                        log.trace(data);
                        var xml;
                        if (typeof data == 'string' || typeof data == 'number') {
                            if (-1 != this.url.indexOf('/api/sdcard/sdcard')) {
                                data = sdResolveCannotParseChar(data);
                            }
                            if (!window.ActiveXObject) {
                                var parser = new DOMParser();
                                xml = parser.parseFromString(data, 'text/xml');
                            }
                            else {
                                //IE
                                xml = new ActiveXObject('Microsoft.XMLDOM');
                                xml.async = false;
                                xml.loadXML(data);
                            }
                        }
                        else {
                            xml = data;
                        }
                        if (typeof callback_func == 'function') {
                            callback_func($(xml));
                        }
                        else {
                            log.error('callback_func is undefined or not a function');
                        }
                    }
                });
            }

            function getConfigData(urlstr, callback_func, options) {
                var myurl = '../' + urlstr + '';
                //var myurl = urlstr + "";
                var isAsync = true;
                var nTimeout = AJAX_TIMEOUT;
                var errorCallback = null;

                if (options) {
                    if (options.sync) {
                        isAsync = (options.sync == true) ? false : true;
                    }
                    if (options.timeout) {
                        nTimeout = parseInt(options.timeout, 10);
                        if (isNaN(nTimeout)) {
                            nTimeout = AJAX_TIMEOUT;
                        }
                    }
                    errorCallback = options.errorCB;
                }

                $.ajax({
                    async: isAsync,
                    //cache: false,
                    type: 'GET',
                    timeout: nTimeout,
                    url: myurl,
                    //dataType: ($.browser.msie) ? "text" : "xml",
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        try {
                            log.debug('MAIN : getConfigData(' + myurl + ') error.');
                            log.error('MAIN : XMLHttpRequest.readyState = ' + XMLHttpRequest.readyState);
                            log.error('MAIN : XMLHttpRequest.status = ' + XMLHttpRequest.status);
                            log.error('MAIN : textStatus ' + textStatus);
                            if (jQuery.isFunction(errorCallback)) {
                                errorCallback(XMLHttpRequest, textStatus);
                            }
                        }
                        catch (exception) {
                            log.error(exception);
                        }
                    },
                    success: function(data) {
                        log.debug('MAIN : getConfigData(' + myurl + ') success.');
                        log.trace(data);
                        var xml;
                        if (typeof data == 'string' || typeof data == 'number') {
                            if (!window.ActiveXObject) {
                                var parser = new DOMParser();
                                xml = parser.parseFromString(data, 'text/xml');
                            }
                            else {
                                //IE
                                xml = new ActiveXObject('Microsoft.XMLDOM');
                                xml.async = false;
                                xml.loadXML(data);
                            }
                        }
                        else {
                            xml = data;
                        }
                        if (typeof callback_func == 'function') {
                            callback_func($(xml));
                        }
                        else {
                            log.error('callback_func is undefined or not a function');
                        }
                    }
                });
            }

            function getDomain(){
                getConfigData("config/lan/config.xml", function($xml){
                    var ret = xml2object($xml);
                    if(ret.type == "config")
                    {
                        DEFAULT_GATEWAY_DOMAIN.push(ret.config.landns.hgwurl.toLowerCase());
                    }
                }, {
                   sync: true
                });
            }

            function getQueryStringByName(item) {
                var svalue = location.search.match(new RegExp('[\?\&]' + item + '=([^\&]*)(\&?)', 'i'));
                return svalue ? svalue[1] : svalue;
            }
            
            function isHandheldBrowser() {
                var bRet = false;

                var hardwarePlatform = navigator.platform.toLowerCase();
                var agent = navigator.userAgent.toLowerCase();

                var isIpod = hardwarePlatform.indexOf("iPod") != -1;
                var isIphone = hardwarePlatform.indexOf("iPhone") != -1;
                var isIpad =  hardwarePlatform.indexOf("iPad") != -1;
                var isAndroid = agent.indexOf("android") !=-1;

                log.debug("INDEX : hardwarePlatform = " + hardwarePlatform);
                log.debug("INDEX : agent = " + agent);

                if (isIphone || isIpod) {
                    log.debug("INDEX : current browser is iphone or ipod.");
                    bRet = true;
                }
                else if (isPsp) {
                    log.debug("INDEX : current browser is psp.");
                    bRet = true;
                }
                else if (isAndroid) {
                    log.debug("INDEX : current browser is android.");
                    bRet = true;
                }
                else {
                    log.debug("INDEX : screen.height = " + screen.height);
                    log.debug("INDEX : screen.width = " + screen.width);
                    if (screen.height <= 320 || screen.width <= 320) {
                        bRet = true;
                        log.debug("INDEX : current browser screen size is small.");
                    }
                }
                log.debug("INDEX : isHandheldBrowser = " + bRet);
                return bRet;
            }
            var g_requestVerificationToken = '';
            function getAjaxToken() {
                 getAjaxData('api/webserver/token', function($xml) {
                    var ret = xml2object($xml);
                     if ('response' == ret.type) {
                         g_requestVerificationToken = ret.response.token;
                         
                     }
                }, {
                       sync: true
                });
            }
            
            getAjaxToken();
            var gatewayAddr = "";
            var conntection_status = null;
            var service_status = null;
			/* BEGIN PN:DTS2013122005045 Added by y81005304 for http remote control,2013-12-20 */
			var wan_ip = "";
			/* END PN:DTS2013122005045 Added by y81005304 for http remote control,2013-12-20 */
            // get current settings gateway address
            getAjaxData("api/dhcp/settings", function($xml) {
                var ret = xml2object($xml);
                if ("response" == ret.type) {
                    gatewayAddr = ret.response.DhcpIPAddress;
                }
            }, {
                sync : true
            }
            );

            // get connection status
            getAjaxData("api/monitoring/status", function($xml) {
                var ret = xml2object($xml);
                if ("response" == ret.type) {
                    conntection_status = parseInt(ret.response.ConnectionStatus);
                    service_status = parseInt(ret.response.ServiceStatus);
					/* BEGIN PN:DTS2013122005045 Added by y81005304 for http remote control,2013-12-20 */
					wan_ip = ret.response.WanIPAddress;
					/* END PN:DTS2013122005045 Added by y81005304 for http remote control,2013-12-20 */
                }
            }, {
                sync : true
            }
            );
            if ("" == gatewayAddr) {
                gatewayAddr = DEFAULT_GATEWAY_IP;
            }

            var href = "http://" + DEFAULT_GATEWAY_IP;
            try {
                href = window.location.href;
            }
            catch(exception) {
                href = "http://" + DEFAULT_GATEWAY_IP;
            }
            // get incoming url from querystring
            var incoming_url = href.substring(href.indexOf("?url=") + 5);
            // truncate http://
            if (incoming_url.indexOf("//") > -1) {
                incoming_url = incoming_url.substring(incoming_url.indexOf("//") + 2);
            }
            //get *.html
            var incoming_html = "";
            if (incoming_url.indexOf(".html") > -1) {
                incoming_html = incoming_url.substring(incoming_url.lastIndexOf("/") + 1, incoming_url.length);
            }
            // truncate tail
            if (incoming_url.indexOf("/") !=  -1) {
                incoming_url = incoming_url.substring(0, incoming_url.indexOf("/"));
            }

            incoming_url = incoming_url.toLowerCase();
            var bIsSmallPage = isHandheldBrowser();
            var bIsSmallPage = false; //myadd
            // var prefix = "http://" + gatewayAddr;
            var g_indexIncomingUrlIsGateway = false;
            // if incoming url == 192.168.1.1 or MobileWifi.home then goto login
            // page
            window.name = getQueryStringByName("version");
			//check login status
			var LOGIN_STATES_SUCCEED = "0";
			var userLoginState = LOGIN_STATES_SUCCEED;
			getAjaxData('api/user/state-login', function($xml) {
				var ret = xml2object($xml);
				if (ret.type == 'response') {
					userLoginState=ret.response.State;
				}
			}, {
				sync: true
			});			
			if(true == bIsSmallPage) {
				if (userLoginState != LOGIN_STATES_SUCCEED) {
					gotoPageWithoutHistory("../small/html/logins.htm");
					g_indexIncomingUrlIsGateway = true;
				} else {
					gotoPageWithoutHistory("../small/html/menus.htm");
					g_indexIncomingUrlIsGateway = true;
				}
			} else {
                g_indexIncomingUrlIsGateway = redirectOnCondition();
            }

            $( function() {
                getDomain();
                if (g_indexIncomingUrlIsGateway) {
                    return;
                }
                else if (conntection_status == 901 && service_status == 2) {
                    /* BEGIN PN:DTS2013122005045 Added by y81005304 for http remote control,2013-12-20 */
					if ((incoming_url.indexOf(gatewayAddr)==0)|| (incoming_url.indexOf(DEFAULT_GATEWAY_DOMAIN)==0) || (incoming_url.indexOf(wan_ip)==0))  {
					/* END PN:DTS2013122005045 Added by y81005304 for http remote control,2013-12-20 */
                           gotoPageWithoutHistory("home.html");
                     }
                     else {
                          gotoPageWithoutHistory("opennewwindow.html");
                     }
                }
                else {
                    gotoPageWithoutHistory("home.html");
                }
            });
        </script>
    </head>

    <body style="background-color: #FFFFFF;">
        <noscript>
            Sorry, your browser does not support javascript.
        </noscript>
    </body>
</html>
g4"           Y˦>5       ;    :http://192.168.1.1/html/index.html?url=http://192.168.1.1/ strongly-framed 1 request-method GET response-head HTTP/1.1 200 OK
Date: Sun, 05 Aug 2007 17:35:15 GMT
Cache-Control: no-cache
Pragma: no-cache
Server: IPWEBS/1.4.0
Etag: 1.0.0
Expires: -1, Mon, 15 Nov 2021 08:10:24 GMT
Content-Length: 18713
Content-Type: text/html
 original-response-headers Date: Sun, 05 Aug 2007 17:35:15 GMT
Cache-Control: no-cache
Pragma: no-cache
Expires: -1
Server: IPWEBS/1.4.0
Etag: 1.0.0
Expires: Mon, 15 Nov 2021 08:10:24 GMT
Content-Length: 18713
Content-Type: text/html
 charset windows-1252 uncompressed-len 0 predictor::resource-count 3 predictor::http://192.168.1.1/lib/jquery-1.7.2.min.js 1,1,0,16777216 predictor::http://192.168.1.1/lib/log4javascript_lite.js 1,1,0,16777216 predictor::http://192.168.1.1/js/redirect.js 1,1,0,16777216   I